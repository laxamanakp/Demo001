<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MyHubCares - Patient Registration</title>
    <link rel="stylesheet" href="css/main.css">
    <link rel="stylesheet" href="css/components.css">
    <style>
        .registration-container {
            max-width: 700px;
            margin: 40px auto;
            padding: 20px;
        }

        .registration-card {
            background: white;
            border-radius: var(--border-radius-lg);
            box-shadow: var(--shadow-lg);
            overflow: hidden;
        }

        .registration-header {
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--primary-dark) 100%);
            color: white;
            text-align: center;
            padding: 40px 30px;
        }

        .registration-body {
            padding: 40px 30px;
        }

        .progress-steps {
            display: flex;
            justify-content: space-between;
            margin-bottom: 40px;
            position: relative;
        }

        .progress-steps::before {
            content: '';
            position: absolute;
            top: 20px;
            left: 0;
            right: 0;
            height: 2px;
            background: var(--border-color);
            z-index: 0;
        }

        .step {
            position: relative;
            text-align: center;
            flex: 1;
            z-index: 1;
        }

        .step-circle {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: var(--bg-secondary);
            border: 2px solid var(--border-color);
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 10px;
            font-weight: 600;
            transition: all 0.3s;
        }

        .step.active .step-circle {
            background: var(--primary-color);
            border-color: var(--primary-color);
            color: white;
        }

        .step.completed .step-circle {
            background: var(--success-color);
            border-color: var(--success-color);
            color: white;
        }

        .step-label {
            font-size: 13px;
            color: var(--text-secondary);
        }

        .step.active .step-label {
            color: var(--primary-color);
            font-weight: 600;
        }

        .registration-step {
            display: none;
        }

        .registration-step.active {
            display: block;
        }

        .form-section {
            margin-bottom: 30px;
        }

        .form-section h3 {
            font-size: 18px;
            color: var(--text-primary);
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid var(--border-color);
        }

        .form-actions {
            display: flex;
            justify-content: space-between;
            gap: 12px;
            margin-top: 30px;
            padding-top: 30px;
            border-top: 1px solid var(--border-color);
        }

        .welcome-message {
            background: #eff6ff;
            padding: 20px;
            border-radius: var(--border-radius);
            margin-bottom: 20px;
            border-left: 4px solid var(--primary-color);
        }

        .branch-selection {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
            margin-top: 12px;
        }

        .branch-card {
            border: 2px solid var(--border-color);
            border-radius: var(--border-radius);
            padding: 16px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .branch-card:hover {
            border-color: var(--primary-color);
            background: #eff6ff;
        }

        .branch-card.selected {
            border-color: var(--primary-color);
            background: #eff6ff;
        }

        .branch-card input[type="radio"] {
            display: none;
        }

        .success-icon {
            font-size: 64px;
            text-align: center;
            margin: 20px 0;
        }
    </style>
</head>
<body class="login-page">
    <div class="registration-container">
        <div class="registration-card">
            <div class="registration-header">
                <div class="logo">
                    <svg width="60" height="60" viewBox="0 0 60 60" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <rect width="60" height="60" rx="10" fill="white" fill-opacity="0.2"/>
                        <path d="M30 15L20 25H26V35H22V45H30V35H34V45H42V35H38V25H44L30 15Z" fill="white"/>
                    </svg>
                </div>
                <h1>Welcome to MyHubCares!</h1>
                <p>"It's my hub, and it's yours" - Welcome Home!</p>
            </div>

            <div class="registration-body">
                <!-- Progress Steps -->
                <div class="progress-steps">
                    <div class="step active" data-step="1">
                        <div class="step-circle">1</div>
                        <div class="step-label">Personal Info</div>
                    </div>
                    <div class="step" data-step="2">
                        <div class="step-circle">2</div>
                        <div class="step-label">Contact Details</div>
                    </div>
                    <div class="step" data-step="3">
                        <div class="step-circle">3</div>
                        <div class="step-label">Account Setup</div>
                    </div>
                    <div class="step" data-step="4">
                        <div class="step-circle">4</div>
                        <div class="step-label">Complete</div>
                    </div>
                </div>

                <form id="registrationForm">
                    <!-- Step 1: Personal Information -->
                    <div class="registration-step active" data-step="1">
                        <div class="welcome-message">
                            <strong>Welcome to MyHubCares!</strong><br>
                            We're glad you're taking the first step. All information is confidential and secure.
                        </div>

                        <div class="form-section">
                            <h3>Personal Information</h3>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label class="required">First Name</label>
                                    <input type="text" id="firstName" required placeholder="Enter first name">
                                </div>
                                <div class="form-group">
                                    <label>Middle Name</label>
                                    <input type="text" id="middleName" placeholder="Enter middle name (optional)">
                                </div>
                            </div>

                            <div class="form-row">
                                <div class="form-group">
                                    <label class="required">Last Name</label>
                                    <input type="text" id="lastName" required placeholder="Enter last name">
                                </div>
                                <div class="form-group">
                                    <label>Suffix</label>
                                    <select id="suffix">
                                        <option value="">None</option>
                                        <option value="Jr.">Jr.</option>
                                        <option value="Sr.">Sr.</option>
                                        <option value="II">II</option>
                                        <option value="III">III</option>
                                    </select>
                                </div>
                            </div>

                            <div class="form-row">
                                <div class="form-group">
                                    <label class="required">Date of Birth</label>
                                    <input type="date" id="birthDate" required max="2010-12-31">
                                </div>
                                <div class="form-group">
                                    <label class="required">Sex Assigned at Birth</label>
                                    <select id="sex" required>
                                        <option value="">Select</option>
                                        <option value="M">Male</option>
                                        <option value="F">Female</option>
                                    </select>
                                </div>
                            </div>

                            <div class="form-group">
                                <label class="required">Civil Status</label>
                                <select id="civilStatus" required>
                                    <option value="">Select Status</option>
                                    <option value="Single">Single</option>
                                    <option value="Married">Married</option>
                                    <option value="Widowed">Widowed</option>
                                    <option value="Separated">Separated</option>
                                </select>
                            </div>

                            <div class="form-group">
                                <label>Nationality</label>
                                <input type="text" id="nationality" value="Filipino">
                            </div>
                        </div>
                    </div>

                    <!-- Step 2: Contact Details -->
                    <div class="registration-step" data-step="2">
                        <div class="form-section">
                            <h3>Contact Information</h3>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label class="required">Mobile Number</label>
                                    <input type="tel" id="contactPhone" required placeholder="09XX-XXX-XXXX" pattern="[0-9]{4}-[0-9]{3}-[0-9]{4}">
                                    <small class="text-muted">Format: 09XX-XXX-XXXX</small>
                                </div>
                                <div class="form-group">
                                    <label class="required">Email Address</label>
                                    <input type="email" id="email" required placeholder="your.email@example.com">
                                </div>
                            </div>

                            <div class="form-row">
                                <div class="form-group">
                                    <label class="required">Current City</label>
                                    <input type="text" id="currentCity" required placeholder="Enter city">
                                </div>
                                <div class="form-group">
                                    <label class="required">Current Province</label>
                                    <input type="text" id="currentProvince" required placeholder="Enter province">
                                </div>
                            </div>

                            <div class="form-group">
                                <label>PhilHealth Number (if available)</label>
                                <input type="text" id="philhealthNo" placeholder="XX-XXXXXXXXX-X">
                            </div>
                        </div>

                        <div class="form-section">
                            <h3>Preferred MyHubCares Branch</h3>
                            
                            <div class="branch-selection">
                                <label class="branch-card">
                                    <input type="radio" name="branch" value="1" required checked>
                                    <div>
                                        <strong>üè• MyHubCares</strong><br>
                                        <small>Ortigas Main Branch</small><br>
                                        <small>Pearl Drive, Pasig City</small><br>
                                        <small>üìû 0917-187-2273</small>
                                    </div>
                                </label>

                                <label class="branch-card">
                                    <input type="radio" name="branch" value="2" required>
                                    <div>
                                        <strong>üè• MyHubCares</strong><br>
                                        <small>Pasay Branch</small><br>
                                        <small>Pasay City</small><br>
                                        <small>üìû 0898-700-1267</small>
                                    </div>
                                </label>

                                <label class="branch-card">
                                    <input type="radio" name="branch" value="3" required>
                                    <div>
                                        <strong>üè• MyHubCares</strong><br>
                                        <small>Alabang Branch</small><br>
                                        <small>Muntinlupa City</small><br>
                                        <small>üìû 0954-468-1630</small>
                                    </div>
                                </label>
                            </div>
                        </div>
                    </div>

                    <!-- Step 3: Account Setup -->
                    <div class="registration-step" data-step="3">
                        <div class="welcome-message">
                            <strong>Create Your Patient Portal Account</strong><br>
                            Use this account to book appointments, view prescriptions, and manage your health.
                        </div>

                        <div class="form-section">
                            <h3>Account Credentials</h3>
                            
                            <div class="form-group">
                                <label class="required">Username</label>
                                <input type="text" id="username" required placeholder="Choose a username" minlength="4">
                                <small class="text-muted">At least 4 characters, no spaces</small>
                            </div>

                            <div class="form-group">
                                <label class="required">Password</label>
                                <input type="password" id="password" required placeholder="Create a strong password" minlength="6">
                                <small class="text-muted">At least 6 characters</small>
                            </div>

                            <div class="form-group">
                                <label class="required">Confirm Password</label>
                                <input type="password" id="confirmPassword" required placeholder="Re-enter password">
                            </div>
                        </div>

                        <div class="form-section">
                            <h3>Terms and Consent</h3>
                            
                            <div class="form-group">
                                <label>
                                    <input type="checkbox" id="termsConsent" required>
                                    I agree to the <a href="#" onclick="showTerms(); return false;">Terms and Conditions</a> and <a href="#" onclick="showPrivacy(); return false;">Privacy Policy</a>
                                </label>
                            </div>

                            <div class="form-group">
                                <label>
                                    <input type="checkbox" id="dataConsent" required>
                                    I consent to the collection and processing of my health information in accordance with the Data Privacy Act of 2012
                                </label>
                            </div>

                            <div class="form-group">
                                <label>
                                    <input type="checkbox" id="smsConsent">
                                    I agree to receive appointment reminders and health updates via SMS and email
                                </label>
                            </div>
                        </div>
                    </div>

                    <!-- Step 4: Confirmation -->
                    <div class="registration-step" data-step="4">
                        <div class="success-icon">‚úÖ</div>
                        <h2 class="text-center">Registration Successful!</h2>
                        
                        <div class="welcome-message">
                            <strong>Welcome to the MyHubCares family!</strong><br>
                            Your account has been created successfully. You can now access your patient portal.
                        </div>

                        <div class="card mt-3">
                            <div class="card-body">
                                <h4>Your Account Details</h4>
                                <div class="form-group">
                                    <label>Unique Identifier Code (UIC)</label>
                                    <input type="text" id="displayUIC" readonly>
                                </div>
                                <div class="form-group">
                                    <label>Username</label>
                                    <input type="text" id="displayUsername" readonly>
                                </div>
                                <div class="form-group">
                                    <label>Preferred Branch</label>
                                    <input type="text" id="displayBranch" readonly>
                                </div>
                            </div>
                        </div>

                        <div class="alert alert-info mt-3">
                            <strong>Next Steps:</strong>
                            <ul style="margin: 10px 0 0 20px;">
                                <li>Log in to your patient portal</li>
                                <li>Complete your health profile</li>
                                <li>Book your first appointment</li>
                                <li>Set up medication reminders</li>
                            </ul>
                        </div>

                        <div class="text-center mt-3">
                            <button type="button" class="btn btn-primary btn-lg" onclick="window.location.href='index.html'">
                                Go to Login
                            </button>
                        </div>
                    </div>

                    <!-- Form Actions -->
                    <div class="form-actions" id="formActions">
                        <button type="button" class="btn btn-secondary" id="prevBtn" onclick="previousStep()" style="display: none;">
                            ‚Üê Previous
                        </button>
                        <button type="button" class="btn btn-outline" onclick="window.location.href='index.html'">
                            Cancel
                        </button>
                        <button type="button" class="btn btn-primary" id="nextBtn" onclick="nextStep()">
                            Next ‚Üí
                        </button>
                        <button type="submit" class="btn btn-success" id="submitBtn" style="display: none;">
                            Complete Registration
                        </button>
                    </div>
                </form>

                <div class="text-center mt-3">
                    <p class="text-muted">Already have an account? <a href="index.html">Login here</a></p>
                </div>
            </div>
        </div>
    </div>

    <script src="js/mockData.js"></script>
    <script>
        let currentStep = 1;
        const totalSteps = 4;

        // Branch selection handling
        document.querySelectorAll('.branch-card').forEach(card => {
            card.addEventListener('click', function() {
                document.querySelectorAll('.branch-card').forEach(c => c.classList.remove('selected'));
                this.classList.add('selected');
                this.querySelector('input[type="radio"]').checked = true;
            });
        });

        // Pre-select first branch (Ortigas Main)
        document.querySelector('.branch-card').classList.add('selected');

        function updateStepIndicators() {
            document.querySelectorAll('.step').forEach(step => {
                const stepNum = parseInt(step.getAttribute('data-step'));
                step.classList.remove('active', 'completed');
                
                if (stepNum === currentStep) {
                    step.classList.add('active');
                } else if (stepNum < currentStep) {
                    step.classList.add('completed');
                }
            });

            document.querySelectorAll('.registration-step').forEach(step => {
                step.classList.remove('active');
                if (parseInt(step.getAttribute('data-step')) === currentStep) {
                    step.classList.add('active');
                }
            });

            // Update buttons
            document.getElementById('prevBtn').style.display = currentStep > 1 && currentStep < 4 ? 'block' : 'none';
            document.getElementById('nextBtn').style.display = currentStep < 3 ? 'block' : 'none';
            document.getElementById('submitBtn').style.display = currentStep === 3 ? 'block' : 'none';
            document.getElementById('formActions').style.display = currentStep === 4 ? 'none' : 'flex';
        }

        function validateStep(step) {
            const stepElement = document.querySelector(`.registration-step[data-step="${step}"]`);
            const inputs = stepElement.querySelectorAll('input[required], select[required]');
            
            for (let input of inputs) {
                if (!input.checkValidity()) {
                    input.reportValidity();
                    return false;
                }
            }

            // Additional validation for step 3
            if (step === 3) {
                const password = document.getElementById('password').value;
                const confirmPassword = document.getElementById('confirmPassword').value;
                
                if (password !== confirmPassword) {
                    alert('Passwords do not match!');
                    return false;
                }

                const username = document.getElementById('username').value;
                if (username.includes(' ')) {
                    alert('Username cannot contain spaces');
                    return false;
                }

                // Check if username already exists
                const users = JSON.parse(localStorage.getItem('users')) || [];
                if (users.find(u => u.username === username)) {
                    alert('Username already exists. Please choose another.');
                    return false;
                }
            }

            return true;
        }

        function nextStep() {
            if (!validateStep(currentStep)) {
                return;
            }

            if (currentStep < totalSteps) {
                currentStep++;
                updateStepIndicators();
            }
        }

        function previousStep() {
            if (currentStep > 1) {
                currentStep--;
                updateStepIndicators();
            }
        }

        function generateUIC(firstName, lastName, birthDate) {
            const date = new Date(birthDate);
            const motherLetters = (firstName.substring(0, 2) || 'XX').toUpperCase();
            const fatherLetters = (lastName.substring(0, 2) || 'XX').toUpperCase();
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const day = String(date.getDate()).padStart(2, '0');
            const year = date.getFullYear();
            
            return `${motherLetters}${fatherLetters}${month}${day}${year}`;
        }

        function showTerms() {
            alert('Terms and Conditions:\n\nBy using MyHubCares services, you agree to:\n- Provide accurate information\n- Maintain confidentiality of your account\n- Follow treatment plans as prescribed\n- Respect staff and other patients\n\n(Full terms would be displayed in production)');
        }

        function showPrivacy() {
            alert('Privacy Policy:\n\nMyHubCares respects your privacy and is committed to protecting your personal information in accordance with the Data Privacy Act of 2012.\n\n- Your health information is confidential\n- Data is encrypted and secure\n- Information is used only for healthcare purposes\n- You can request data deletion at any time\n\n(Full policy would be displayed in production)');
        }

        document.getElementById('registrationForm').addEventListener('submit', function(e) {
            e.preventDefault();

            if (!validateStep(3)) {
                return;
            }

            // Get form data
            const formData = {
                firstName: document.getElementById('firstName').value,
                middleName: document.getElementById('middleName').value,
                lastName: document.getElementById('lastName').value,
                suffix: document.getElementById('suffix').value,
                birthDate: document.getElementById('birthDate').value,
                sex: document.getElementById('sex').value,
                civilStatus: document.getElementById('civilStatus').value,
                nationality: document.getElementById('nationality').value,
                contactPhone: document.getElementById('contactPhone').value,
                email: document.getElementById('email').value,
                currentCity: document.getElementById('currentCity').value,
                currentProvince: document.getElementById('currentProvince').value,
                philhealthNo: document.getElementById('philhealthNo').value,
                facilityId: parseInt(document.querySelector('input[name="branch"]:checked').value),
                username: document.getElementById('username').value,
                password: document.getElementById('password').value
            };

            // Generate UIC
            const uic = generateUIC(formData.firstName, formData.lastName, formData.birthDate);

            // Create patient record
            const patients = JSON.parse(localStorage.getItem('patients')) || [];
            const newPatientId = patients.length > 0 ? Math.max(...patients.map(p => p.id)) + 1 : 100;

            const newPatient = {
                id: newPatientId,
                uic: uic,
                philhealthNo: formData.philhealthNo,
                firstName: formData.firstName,
                middleName: formData.middleName,
                lastName: formData.lastName,
                suffix: formData.suffix,
                birthDate: formData.birthDate,
                sex: formData.sex,
                civilStatus: formData.civilStatus,
                nationality: formData.nationality,
                currentCity: formData.currentCity,
                currentProvince: formData.currentProvince,
                contactPhone: formData.contactPhone,
                email: formData.email,
                createdAt: new Date().toISOString()
            };

            patients.push(newPatient);
            localStorage.setItem('patients', JSON.stringify(patients));

            // Create user account
            const users = JSON.parse(localStorage.getItem('users')) || [];
            const newUserId = users.length > 0 ? Math.max(...users.map(u => u.id)) + 1 : 100;

            const newUser = {
                id: newUserId,
                username: formData.username,
                password: formData.password,
                role: 'patient',
                fullName: `${formData.firstName} ${formData.lastName}`,
                email: formData.email,
                facilityId: formData.facilityId,
                patientId: newPatientId
            };

            users.push(newUser);
            localStorage.setItem('users', JSON.stringify(users));

            // Show confirmation details
            document.getElementById('displayUIC').value = uic;
            document.getElementById('displayUsername').value = formData.username;
            
            const facilities = JSON.parse(localStorage.getItem('facilities')) || [];
            const selectedFacility = facilities.find(f => f.id === formData.facilityId);
            document.getElementById('displayBranch').value = selectedFacility ? selectedFacility.name : 'N/A';

            // Move to step 4
            currentStep = 4;
            updateStepIndicators();
        });

        // Initialize
        updateStepIndicators();
    </script>
</body>
</html>

